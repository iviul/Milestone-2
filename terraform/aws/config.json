{
  "project": {
    "name": "my-infra",
    "environment": "dev",
    "region": "europe",
    "os": "ubuntu",
    "terraform_username":"terraform_user"
  },

  "network": {
    "vpc_cidr": "10.0.0.0/16",
    "subnets": [
      {
        "name": "public-subnet",
        "cidr": "10.0.1.0/24",
        "zone": "a",
        "public": true
      },
      {
        "name": "private-subnet",
        "cidr": "10.0.2.0/24",
        "zone": "b",
        "public": false
      }
    ]
  },

  "vm_instances": [
    {
      "name": "reverse-proxy",
      "size": "small",
      "zone": "a",
      "subnet": "public-subnet",
      "tags": ["proxy"],
      "port": 80
    },
    {
      "name": "backend",
      "size": "small",
      "zone": "b",
      "subnet": "private-subnet",
      "tags": ["backend"],
      "port": 8080
    }
  ],

  "databases": [
    {
      "name": "main-db",
      "type": "postgres",
      "version": "14",
      "size": "small",
      "zone": "b",
      "subnet": "private-subnet",
      "port": 5432
    }
  ],

  "networks": [
    { "name": "public",   "cidr": "0.0.0.0/0" },
    { "name": "internal", "cidr": "10.0.0.0/16" }
  ],

  "security_groups": [
    {
      "name": "sg-reverse-proxy",
      "attach_to": ["reverse-proxy"],
      "description": "Allow public HTTP traffic and forward to front/back",
      "ingress": [
        { "protocol": "tcp", "port": 80, "source": "public" }
      ],
      "egress": [
        { "protocol": "tcp", "port": 3000, "destination": "frontend" },
        { "protocol": "tcp", "port": 8080, "destination": "backend" }
      ]
    },
    {
      "name": "sg-frontend",
      "attach_to": ["frontend"],
      "description": "Serve assets to proxy",
      "ingress": [
        { "protocol": "tcp", "port": 3000, "source": "reverse-proxy" }
      ],
      "egress": []
    },
    {
      "name": "sg-backend",
      "attach_to": ["backend"],
      "description": "API server behind proxy with DB/Redis access",
      "ingress": [
        { "protocol": "tcp", "port": 8080, "source": "reverse-proxy" }
      ],
      "egress": [
        { "protocol": "tcp", "port": 5432, "destination": "main-db" },
        { "protocol": "tcp", "port": 6379, "destination": "redis" }
      ]
    },
    {
      "name": "sg-db",
      "attach_to": ["main-db"],
      "description": "PostgreSQL accessible only from backend",
      "ingress": [
        { "protocol": "tcp", "port": 5432, "source": "backend" }
      ],
      "egress": []
    },
    {
      "name": "sg-redis",
      "attach_to": ["redis"],
      "description": "Redis accessible only from backend",
      "ingress": [
        { "protocol": "tcp", "port": 6379, "source": "backend" }
      ],
      "egress": []
    }
  ]
}